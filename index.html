<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV Player | Converge & Cignal</title>

<style>
    * {margin: 0; padding: 0; box-sizing: border-box;}
    body { background: #1a1a1a; font-family: Arial; color: #fff; }

    header {
        background: linear-gradient(135deg,#667eea,#764ba2);
        padding: 15px; text-align: center;
    }

    .player-container { background:#000; margin:10px; border-radius:10px; overflow:hidden; }
    video { width:100%; height:300px; background:#000; }

    .controls { text-align:center; margin:10px; }
    button {
        padding:10px 15px; margin:5px; border:0;
        border-radius:10px; cursor:pointer; font-weight:bold;
    }
    #converge-btn { background:#f5576c; color:white; }
    #cignal-btn { background:#4facfe; color:white; }

    .channel-list { margin:10px; background:#2e2e2e; border-radius:8px; overflow-y:auto; height:300px; }
    .channel-item {
        padding:12px; border-bottom:1px solid #444;
        cursor:pointer; transition:0.2s;
    }
    .channel-item:hover { background:#444; }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.4/shaka-player.compiled.min.js"></script>

</head>
<body>

<header>
    <h2>IPTV Player</h2>
    <p>Converge & Cignal</p>
</header>

<div class="player-container">
    <video id="video" controls autoplay playsinline></video>
</div>

<div class="controls">
    <button id="converge-btn">Converge Playlist</button>
    <button id="cignal-btn">Cignal Playlist</button>
</div>

<div class="channel-list" id="channel-list">
    <div style="text-align:center; opacity:0.6; padding:20px;">Select playlist</div>
</div>

<script>
let player;
let currentPlaylist = "";
let channels = [];

// Playlist URLs
const PLAYLIST_URLS = {
    converge: "https://reiyhbit.github.io/iptv/playlist112525.m3u",
    cignal:   "https://reiyhbit.github.io/iptv/playlist.m3u"
};

// Initialize Shaka
document.addEventListener("DOMContentLoaded", async () => {
    shaka.polyfill.installAll();
    if (!shaka.Player.isBrowserSupported()) {
        alert("Browser not supported.");
        return;
    }
    player = new shaka.Player(document.getElementById("video"));
});

// Load playlist
async function loadPlaylist(type) {
    currentPlaylist = type;
    const response = await fetch(PLAYLIST_URLS[type]);
    const text = await response.text();
    channels = parseM3U(text);

    renderChannels();
}

// Parse M3U
function parseM3U(data) {
    const lines = data.split("\n");
    let list = [];
    let name = "";

    for (let i = 0; i < lines.length; i++) {
        let line = lines[i].trim();

        if (line.startsWith("#EXTINF")) {
            name = line.split(",")[1] || "Unknown";
        } else if (line.startsWith("http")) {
            list.push({
                name,
                url: line.trim()
            });
        }
    }
    return list;
}

// Render channel list
function renderChannels() {
    const div = document.getElementById("channel-list");
    div.innerHTML = "";

    channels.forEach((ch, index) => {
        let item = document.createElement("div");
        item.className = "channel-item";
        item.innerText = ch.name;
        item.onclick = () => playChannel(index);
        div.appendChild(item);
    });
}

// Play channel
async function playChannel(index) {
    let stream = channels[index].url;

    try {
        await player.load(stream);
        console.log("Playing:", channels[index].name);
    } catch (err) {
        console.error("Playback error:", err);
        alert("Stream failed to load.");
    }
}

// Button events
document.getElementById("converge-btn").onclick = () => loadPlaylist("converge");
document.getElementById("cignal-btn").onclick = () => loadPlaylist("cignal");

</script>

</body>
</html>
